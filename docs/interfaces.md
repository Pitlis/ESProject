# Интерфейсы #

----------
Используются для разработки внешних модулей: анализаторов и репозиториев.

**Список интерфейсов:**

* [IDomainIdentity](#idomainidentity)
* IRepository
* [IFactor](#ifactor)
* [IFactorFormData](#ifactorformdata)
* [IFactorProgramData](#ifactorprogramdata)


## IDomainIdentity ##
Этот шаблонный интерфейс реализуют основные классы доменной модели: **ClassRoom**, **ClassRoomType**, **StudentSubGroup**, **StudentsClass**, **Teacher**. Предназначен для упрощения идентификации объектов. Не рекомендуется использовать при реализации анализаторов, т.к. негативно сказывается на производительности.

**Методы:**

**int ID { get; set; }** - переопределение значения свойства может привести к непредсказуемым последствиям! 

**bool EqualsByID(T obj)** - сравнение двух объектов по ID.

**bool EqualsByParams(T obj)** - сравнение двух объектов по всем внутренним полям. Если класс, для которого вызывается метод, содержит объекты другого класса, реализующего интерфейс IDomainIdentity, то у этих объектов вызывается метод EqualsByParams(T obj). Т.е. происходит глубокое сравнение объектов. При сравнении не учитывается значение поля Id.

T - тип класса, реализующего интерфейс.

Классы доменной модели явно реализуют этот интерфейс, скрывая его методы. Это сделано, чтобы не возникало желание постоянно использовать методы интерфейса, снижая тем самым производительность системы. Для использования методов интерфейса требуется явно привести объект класса к типу интерфейса.

Пример вызова методов:

	//например объекты содержат разные ID, но полностью совпадают по значениям свойств
    StudentsClass cl1 = GetSomethingStudentsClass(1);
    StudentsClass cl2 = GetSomethingStudentsClass(2);

	int id1 = ((IDomainIdentity<StudentsClass>)cl1).ID; // 1
	int id2 = ((IDomainIdentity<StudentsClass>)cl2).ID; // 2

	//сравнение по ID
	((IDomainIdentity<StudentsClass>)cl1).EqualsByID(cl2); // false

	//сравнение по свойствам
	((IDomainIdentity<StudentsClass>)cl1).EqualsByParams(cl2); // true

## IFactor ##
Интерфейс анализатора. Класс должен реализовывать этот интерфейс, чтобы он мог подключиться к системе и участвовать в формировании расписания. По умолчанию анализатор не требует никаких дополнительных данных для работы. Если необходимо получить данные от пользователя и/или сформировать их программно - класс анализатора также должен реализовывать соответствующие интерфейсы IFactorFormData, IFactorProgramData (если будут реализованы сразу оба - пользователь сможет редактировать программно сформированный набор данных).

**Методы:**

**string GetName()** - возвращает имя анализатора - выводится в списке подключенных анализаторов.

**string GetDescription()** - подробное описание, для чего предназначен анализатор.

**Guid? GetDataTypeGuid()** - возвращает код типа данных, которые требуются анализатору для работы. Если не требуются никакие дополнительные данные - возвращается null.

**void Initialize(int fine = 0, bool isBlock = false, object data = null)** - подготовка нового объекта анализатора к работе - передаются его настройки, а также (опционально) дополнительные данные.

**int GetFineOfAddedClass(ISchedule schedule, EntityStorage eStorage)** - анализ последней добавленной в расписание пары - возвращает штраф, образованный добавлением этой пары.

**int GetFineOfFullSchedule(ISchedule schedule, EntityStorage eStorage)** - анализ полного расписания - возвращает суммарный штраф расписания.


## IFactorFormData ##
Интерфейс предназначен для получения анализатором данных с пользовательской формы. 

Если анализатор реализует этот интерфейс, то система проверяет, поддерживается ли редактирование типа данных, возвращаемого методом GetDataTypeGuid() (IFactor). Если редактирование поддерживается (т.е. форма для редактирования существует), то пользователю предоставляется возможность изменить данные для анализатора.

**Методы:**

**string GetUserInstructions()** - возвращает инструкции для пользователя, которые будут выведены на форме редактирования.

**EntityStorage FilterStorage(EntityStorage eStorage)** - возвращает отфильтрованную копию внутреннего хранилища, которое содержит только те данные, которые пользователю разрешается передавать в данный анализатор. Например, если в анализатор требуется передать только список лекций, то метод удалит из копии хранилища все занятия не-лекции, т.е. пользователь не увидит их на форме редактирования.

## IFactorProgramData ##
Интерфейс предназначен для программного формирования данных для анализатора из хранилища. Если анализатор реализует этот интерфейс, то система передает ему внутреннее хранилища для формирования выборки данных. Реализация интерфейса не должна сохранять данные внутри объекта анализатора, т.к. в ходе работы системы постоянно создаются новые экземпляры класса анализатора - требуется вернуть все необходимые для работы данные системе.

**Методы:**

**object CreateAndReturnData(EntityStorage eStorage)** - в метод передается хранилище, метод выбирает из него все необходимые анализатору данные, упаковывает их в нужный тип и возвращает в виде объекта. При инициализации, система передаст анализатору этот объект.
